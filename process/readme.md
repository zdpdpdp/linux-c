# 进程和线程

## 进程

> 是操作系统分配和管理资源的基本单位

使用 fork 创建一个子进程

## 线程

> 是进程的一个执行单元，是操作系统执行调度的最小单位

线程拥有自己独立的运行栈，当线程发生切换时，CPU会保留现场

如果一个线程发生崩溃，那么整个进程都会停掉

线程相比于进程，开销小，切换快

## 地址空间

每个进程拥有独立的地址空间， 包含了变量，代码，打开文件描述符（fd）等

在进程之间，地址空间是隔离的， 而属于同一个进程的所有线程共享同一片地址空间

## 进程的Copy on wirte 机制

进程 fork 一个子进程后，子进程使用父进程的物理内存空间，当父进程或子进程有修改内存时，操作系统才为子进程分配相应的物理空间，但是也只是分配了被修改的内存页， redis 的持久化技术就是利用这一点实现的。


## 进程的通讯方式

1.  管道（无名管道）

存在内存中的一个文件描述符，数据只能在一个方向流动，即拥有固定的读端和写端

只能用于具有亲缘关系的进程之间通信，速度慢

2. FIFO（命名管道）

可以在无关进程之间通信，以一种特殊文件形式存在文件系统中

3. 消息队列

4. 信号量

不能用来传递复杂消息，只能用来同步

5. 共享内存